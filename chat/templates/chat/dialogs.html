{% extends 'home/base.html' %}
{% load static %}
{% block title %}Сообщения{% endblock %}
{% block content %}
<div class="mx-auto" style="width: 35%;">
    <form action="{% url 'chat_url' %}">
    <input class="form-control" type="search" placeholder="Поиск людей" name="search_chats">
     <div class="card text-center">
       <div class="card-body">
      <button type="submit" style="width:100%;" class="btn btn-outline-primary">Поиск</button>
       </div>
     </div>
  </form>
    <a style="width:100%;" class="btn btn-outline-primary" href="{% url 'new_chat_url' %}">Начать новый чат</a>
  {% for chat in chat %}
    {% if chat.count >= 3 %}
    <div class="card text-center"  onClick="document.location='{{ chat.id }}'">
    <div class="media" >
      <img src="/media/{{ chat.image_chat }}" style="width:100px; padding:5px;" class="mr-3" alt="Не удалось загрузить изображение">
      <div class="media-body">
        <h7 class="mt-0">
            <a href="{{ chat.id }}" style="float:left;"> {{ chat.group_name }}</a></br>
          <p style="font-size:10pt; color: #5f5f5f; text-align:left;">{{ chat.message.0.author.profile.first_name }} {{ chat.message.0.author.profile.last_name }}
              &#160; &#160;{{ chat.message.0.timestamp }}</p>
        </h7>
        <p style="text-align:left;overflow: hidden;height: 50px;">{{ chat.message.0.content }}</p>
      </div>
        </div>
    </div>
{% else %}
    {% if user == chat.members.all.0 %}
    <div class="card text-center"  onClick="document.location='{{ chat.id }}'">
    <div class="media" >
      <img src="/media/{{ chat.members.all.1.profile.image  }}" style="width:100px; padding:5px;" class="mr-3" alt="Не удалось загрузить изображение">
      <div class="media-body">
        <h7 class="mt-0">
            <a href="{{ chat.id }}" style="float:left;"> {{ chat.members.all.1 }}</a></br>
          <p style="font-size:10pt; color: #5f5f5f; text-align:left;">{{ chat.message.0.author.profile.first_name }} {{ chat.message.0.author.profile.last_name }}
              &#160; &#160;{{ chat.message.0.timestamp }}</p>
        </h7>
        <p style="text-align:left;overflow: hidden;height: 50px;">{{ chat.message.0.content }}</p>
      </div>
        </div>
    </div>
    {% else %}
        <div class="card text-center"  onClick="document.location='{{ chat.id }}'">
    <div class="media" >
      <img src="/media/{{ chat.members.all.0.profile.image  }}" style="width:100px; padding:5px;" class="mr-3" alt="Не удалось загрузить изображение">
      <div class="media-body">
        <h7 class="mt-0">
            <a href="{{ chat.id }}" style="float:left;"> {{ chat.members.all.0 }}</a></br>
          <p style="font-size:10pt; color: #5f5f5f; text-align:left;">{{ chat.message.0.author.profile.first_name }} {{ chat.message.0.author.profile.last_name }}
              &#160; &#160;{{ chat.message.0.timestamp }}</p>
        </h7>
        <p style="text-align:left;overflow: hidden;height: 50px;">{{ chat.message.0.content }}</p>
      </div>
        </div>
    </div>
    {% endif %}
    {%endif %}
        {% endfor %}

</div>
{% endblock %}
